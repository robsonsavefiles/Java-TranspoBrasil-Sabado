/*
 * PanelPedido.java
 *
 * Created on 8 de Abril de 2006, 09:57
 */

package br.org.soujava.teleentrega.gui;
import br.org.soujava.teleentrega.model.*;
import br.org.soujava.teleentrega.persistence.Manager;
import br.org.soujava.teleentrega.util.Formatador;
import java.util.Vector;
import javax.swing.DefaultComboBoxModel;
import java.util.Collection;
import javax.swing.JList;
import javax.swing.table.DefaultTableModel;
public class PanelPedido extends javax.swing.JPanel {
  public TeleEntrega telaPai = null;
  private Pedido entity;
  /** Creates new form PanelPedido */
  public PanelPedido() {
    initComponents();
  }
  
  /** This method is called from within the constructor to
   * initialize the form.
   * WARNING: Do NOT modify this code. The content of this method is
   * always regenerated by the Form Editor.
   */
  // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
  private void initComponents() {
    jLabel1 = new javax.swing.JLabel();
    textCodigo = new javax.swing.JTextField();
    jLabel2 = new javax.swing.JLabel();
    textData = new javax.swing.JTextField();
    jLabel3 = new javax.swing.JLabel();
    comboClientes = new javax.swing.JComboBox();
    jButton1 = new javax.swing.JButton();
    jButton2 = new javax.swing.JButton();
    jTabbedPane1 = new javax.swing.JTabbedPane();
    jPanel1 = new javax.swing.JPanel();
    buttonAdicionarItem = new javax.swing.JButton();
    buttonExcluirItem = new javax.swing.JButton();
    scrolllistItens = new javax.swing.JScrollPane();
    jList1 = new javax.swing.JList();
    labelTotal = new javax.swing.JLabel();
    jPanel2 = new javax.swing.JPanel();
    jScrollPane1 = new javax.swing.JScrollPane();
    textObservacoes = new javax.swing.JTextArea();
    jPanel3 = new javax.swing.JPanel();
    jScrollPane2 = new javax.swing.JScrollPane();
    tablePedidos = new javax.swing.JTable();

    jLabel1.setText("C\u00f3digo");

    textCodigo.setEnabled(false);

    jLabel2.setText("Data Pedido");

    textData.setHorizontalAlignment(javax.swing.JTextField.RIGHT);

    jLabel3.setText("Cliente");

    comboClientes.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));

    jButton1.setText("Cancelar");
    jButton1.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        jButton1ActionPerformed(evt);
      }
    });

    jButton2.setText("OK");
    jButton2.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        jButton2ActionPerformed(evt);
      }
    });

    buttonAdicionarItem.setText("Adicionar Item");
    buttonAdicionarItem.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        buttonAdicionarItemActionPerformed(evt);
      }
    });

    buttonExcluirItem.setText("Excluir Item");
    buttonExcluirItem.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        buttonExcluirItemActionPerformed(evt);
      }
    });

    jList1.setModel(new javax.swing.AbstractListModel() {
      String[] strings = { "Item 1", "Item 2", "Item 3", "Item 4", "Item 5" };
      public int getSize() { return strings.length; }
      public Object getElementAt(int i) { return strings[i]; }
    });
    jList1.addMouseListener(new java.awt.event.MouseAdapter() {
      public void mouseClicked(java.awt.event.MouseEvent evt) {
        jList1MouseClicked(evt);
      }
    });

    scrolllistItens.setViewportView(jList1);

    labelTotal.setFont(new java.awt.Font("Tahoma", 3, 14));
    labelTotal.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
    labelTotal.setText("Total do Pedido");

    org.jdesktop.layout.GroupLayout jPanel1Layout = new org.jdesktop.layout.GroupLayout(jPanel1);
    jPanel1.setLayout(jPanel1Layout);
    jPanel1Layout.setHorizontalGroup(
      jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(jPanel1Layout.createSequentialGroup()
        .addContainerGap()
        .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
          .add(scrolllistItens, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 275, Short.MAX_VALUE)
          .add(jPanel1Layout.createSequentialGroup()
            .add(buttonAdicionarItem)
            .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
            .add(buttonExcluirItem))
          .add(org.jdesktop.layout.GroupLayout.TRAILING, labelTotal, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 275, Short.MAX_VALUE))
        .addContainerGap())
    );
    jPanel1Layout.setVerticalGroup(
      jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(jPanel1Layout.createSequentialGroup()
        .addContainerGap()
        .add(jPanel1Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
          .add(buttonAdicionarItem)
          .add(buttonExcluirItem))
        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
        .add(scrolllistItens, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 141, Short.MAX_VALUE)
        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
        .add(labelTotal)
        .addContainerGap())
    );
    jTabbedPane1.addTab("Itens do pedido", jPanel1);

    textObservacoes.setColumns(20);
    textObservacoes.setRows(5);
    jScrollPane1.setViewportView(textObservacoes);

    org.jdesktop.layout.GroupLayout jPanel2Layout = new org.jdesktop.layout.GroupLayout(jPanel2);
    jPanel2.setLayout(jPanel2Layout);
    jPanel2Layout.setHorizontalGroup(
      jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(jPanel2Layout.createSequentialGroup()
        .addContainerGap()
        .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 275, Short.MAX_VALUE)
        .addContainerGap())
    );
    jPanel2Layout.setVerticalGroup(
      jPanel2Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(org.jdesktop.layout.GroupLayout.TRAILING, jPanel2Layout.createSequentialGroup()
        .addContainerGap()
        .add(jScrollPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 193, Short.MAX_VALUE)
        .addContainerGap())
    );
    jTabbedPane1.addTab("Observa\u00e7\u00f5es", jPanel2);

    tablePedidos.setModel(new javax.swing.table.DefaultTableModel(
      new Object [][] {
        {null, null, null, null},
        {null, null, null, null},
        {null, null, null, null},
        {null, null, null, null}
      },
      new String [] {
        "Title 1", "Title 2", "Title 3", "Title 4"
      }
    ));
    jScrollPane2.setViewportView(tablePedidos);

    org.jdesktop.layout.GroupLayout jPanel3Layout = new org.jdesktop.layout.GroupLayout(jPanel3);
    jPanel3.setLayout(jPanel3Layout);
    jPanel3Layout.setHorizontalGroup(
      jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(jPanel3Layout.createSequentialGroup()
        .addContainerGap()
        .add(jScrollPane2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 275, Short.MAX_VALUE)
        .addContainerGap())
    );
    jPanel3Layout.setVerticalGroup(
      jPanel3Layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(jPanel3Layout.createSequentialGroup()
        .addContainerGap()
        .add(jScrollPane2, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 178, Short.MAX_VALUE)
        .add(26, 26, 26))
    );
    jTabbedPane1.addTab("Itens do Pedido (JTable)", jPanel3);

    org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(this);
    this.setLayout(layout);
    layout.setHorizontalGroup(
      layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(layout.createSequentialGroup()
        .addContainerGap()
        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
          .add(jTabbedPane1)
          .add(layout.createSequentialGroup()
            .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
              .add(jLabel1)
              .add(textCodigo, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 59, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
            .add(6, 6, 6)
            .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
              .add(layout.createSequentialGroup()
                .add(comboClientes, 0, 158, Short.MAX_VALUE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(textData, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 71, Short.MAX_VALUE))
              .add(layout.createSequentialGroup()
                .add(jLabel3)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED, 144, Short.MAX_VALUE)
                .add(jLabel2))))
          .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
            .add(jButton2)
            .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
            .add(jButton1)))
        .addContainerGap())
    );
    layout.setVerticalGroup(
      layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(layout.createSequentialGroup()
        .addContainerGap()
        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
          .add(jLabel1)
          .add(jLabel3)
          .add(jLabel2))
        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
          .add(textCodigo, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
          .add(textData, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
          .add(comboClientes, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
        .add(jTabbedPane1, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 240, Short.MAX_VALUE)
        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
          .add(jButton2)
          .add(jButton1))
        .addContainerGap())
    );
  }// </editor-fold>//GEN-END:initComponents
  

  
  private void buttonExcluirItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonExcluirItemActionPerformed
// TODO add your handling code here:
    if(jList1.getSelectedValue()==null)return;
    Item i = (Item) jList1.getSelectedValue();
    entity.getItens().remove(i);
    jList1.setListData(entity.getItens().toArray());
  }//GEN-LAST:event_buttonExcluirItemActionPerformed
  
  private void jList1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jList1MouseClicked
// TODO add your handling code here:
    if(evt.getClickCount()==2) { //Double-clicked
      
      if(jList1.getSelectedValue()==null)return;
      PanelItemPedido iPanel = new PanelItemPedido(telaPai, true);
      Item i = (Item) jList1.getSelectedValue();
      iPanel.bind(i);
      iPanel.setSize(420,150);
      iPanel.center();
      iPanel.setVisible(true);
      i = iPanel.unbind();
      updateTotal();
      
      /*if(i!=null) {
        i.setPedido(entity);
        entity.getItens().add(i);
        jList1.setListData(entity.getItens().toArray());
      }*/
      
    }
  }//GEN-LAST:event_jList1MouseClicked
  
  private void buttonAdicionarItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonAdicionarItemActionPerformed
// TODO add your handling code here:
    PanelItemPedido iPanel = new PanelItemPedido(telaPai, true);
    Item i = new Item();
    iPanel.bind(i);
    iPanel.setSize(420,150);
    iPanel.center();
    iPanel.setVisible(true);
    
    i = iPanel.unbind();
    if(i!=null) { //se clicou em Cancel retornará null
      i.setPedido(entity);
      entity.getItens().add(i);
      jList1.setListData(entity.getItens().toArray());
      updateTotal();
    }
    
  }//GEN-LAST:event_buttonAdicionarItemActionPerformed
  
  private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
// TODO add your handling code here:
    Manager.getInstance().save(unbind());
    telaPai.populateTree();
  }//GEN-LAST:event_jButton2ActionPerformed
  
  private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
// TODO add your handling code here:
    bind(entity);
  }//GEN-LAST:event_jButton1ActionPerformed
  
  
  // Variables declaration - do not modify//GEN-BEGIN:variables
  private javax.swing.JButton buttonAdicionarItem;
  private javax.swing.JButton buttonExcluirItem;
  private javax.swing.JComboBox comboClientes;
  private javax.swing.JButton jButton1;
  private javax.swing.JButton jButton2;
  private javax.swing.JLabel jLabel1;
  private javax.swing.JLabel jLabel2;
  private javax.swing.JLabel jLabel3;
  private javax.swing.JList jList1;
  private javax.swing.JPanel jPanel1;
  private javax.swing.JPanel jPanel2;
  private javax.swing.JPanel jPanel3;
  private javax.swing.JScrollPane jScrollPane1;
  private javax.swing.JScrollPane jScrollPane2;
  private javax.swing.JTabbedPane jTabbedPane1;
  private javax.swing.JLabel labelTotal;
  private javax.swing.JScrollPane scrolllistItens;
  private javax.swing.JTable tablePedidos;
  private javax.swing.JTextField textCodigo;
  private javax.swing.JTextField textData;
  private javax.swing.JTextArea textObservacoes;
  // End of variables declaration//GEN-END:variables
  public void bind(Pedido pedido) {
    initCombos();
    this.entity=pedido;
    this.textCodigo.setText("" + pedido.getCodigo());
    this.textObservacoes.setText(pedido.getObservacoes());
    this.textData.setText(Formatador.dataSimplesParaString(pedido.getDataPedido()));
    this.comboClientes.setSelectedItem(pedido.getCliente());
    
    jList1.setListData(pedido.getItens().toArray());
    updateTotal();
  }
  public Pedido unbind() {
    entity.setDataPedido(Formatador.dataSimplesParaObjeto(textData.getText()));
    entity.setObservacoes(textObservacoes.getText());
    entity.setCliente((Cliente) comboClientes.getSelectedItem());
    return entity;
  }
  public void initCombos() {
    Collection<Cliente> clientes = Manager.getInstance().getClientes();
    DefaultComboBoxModel modelClientes = new DefaultComboBoxModel(clientes.toArray());
    comboClientes.setModel(modelClientes);
  }
  public void updateTotal() {
    this.labelTotal.setText("Total do Pedido: R$ " + Formatador.moeda(entity.calcularTotal()));
  }
}
